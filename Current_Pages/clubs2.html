<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AHS Clubs Directory</title>
  <meta name="description" content="Allen High School Clubs and Organizations Directory">
  <meta name="theme-color" content="#101E5B">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"></script>

  <!-- Inline stylesheet and loader to improve performance -->
  <style>
  :root {
    --theme-primary: #101E5B;
  }
  body {
    background: var(--theme-primary);
  }
  .center {
    text-align: center;
  }
  .card.main {
    margin-top: 50px;
    margin-bottom: 25px;
    border: 0;
  }
  .card.main img.seamless {
    width: 100%;
    display: block;
  }
  .card.main .body .page-top {
    text-align: center;
  }
  .card.main .body .page-top img {
    width: 100px;
  }
  .card.main .body .search-bar {
    margin-bottom: 20px;
  }
  #club-social-icons {
    font-size: 24pt;
  }
  .footer {
    font-size: 10pt;
  }
  </style>
  <script>
  var clublist = null;
  var storedHash = "";
  var bannerImages = {};

  /*
   * Preload image
   */
  function preload(anchor) {
    var banner = $(anchor).attr("data-banner");
    var id = $(anchor).attr("data-id");
    if(banner != "" && bannerImages[id] == null) {
      var img = new Image();
      img.src = banner;
      img.classList.add("seamless");
      bannerImages[id] = img;
    }
  }

  /*
   * Return human readable club type
   */
  function getTypeName(club) {
    switch(club.type) {
      case 1:
      return "Academic" + ( club.subtype != null ? " - " + club.subtype : "");
      case 2:
      return "Community Service Club";
      case 3:
      return (club.subtype != null ? club.subtype + " " : "") + "Religious Organization";
      case 4:
      return "Social Club";
      case 5:
      return "Athletic Team"  + ( club.subtype != null ? " - " + club.subtype : "");
      case 6:
      return club.subtype;
      case 7:
      return "School Organization";
      case 8:
      return "Extracurricular" + ( club.subtype != null ? " - " + club.subtype : "");
      case 9:
      return "Communication " + ( club.subtype != null ? " - " + club.subtype : "");
      default:
      return "Other";
    }
  }

  function showError(msg) {
    $('#club-body').hide();
    $('#listing-body').hide();
    $('#error-page').show();

    $('#error-msg').text(msg);
  }

  /*
   * Called whenever the # in URL bar changes
   */
  function onHashChanged(hash) {
    console.log("hash " + hash);

    if(hash.indexOf("list") > -1) {
      $('#club-body').hide();
      $('#error-page').hide();
      $('#listing-body').show();
      //$('#club-banner').attr("src", "");
      $('#club-banner-container').empty();
      $('html,body').scrollTop(0);
      return;
    }

    var id = parseInt(hash.replace("#", ""));
    var club = null;
    for(i = 0; i < clublist.length; i++) {
      if(clublist[i].id == id) {
        club = clublist[i];
        break;
      }
    }

    if(club == null) {
      console.log("Club doesn't exist");
      showError("Club doesn't exist");
      return;
    }

    $('#listing-body').hide();
    $('#error-page').hide();
    $('#club-body').show();

    var status = club.status;
    if(status != null && status != 0) {
      $('#club-notice').show();
      if(status == 1) {
        $('#club-notice').html("<strong>This club no longer exists. </strong>This page is kept for archival purposes.");
      }
    }
    else {
      $('#club-notice').hide();
    }

    $('#club-name').text(
      club.name
      + (club.short_name != null ? " (" + club.short_name + ")" : "")
    );

    $('#club-type').text(getTypeName(club));
    $('#club-desc').text(club.description);

    $('#club-website').toggle(club.website != null);
    $('#club-website-url').attr("href", club.website);
    $('#club-website-url').attr("target", "_blank");
    $('#club-website-url').text(club.website);

    $('#club-meeting').toggle(club.meeting != null);
    $('#club-meeting-time').text(club.meeting);

    $('#club-location').toggle(
      (club.location != null) && (club.location.campus == null)
    );
    if(club.location != null && club.location.campus == null) {
      $('#club-location-data').text(club.location.room);
      $('#club-location-data').attr(
        "href",
        "https://google.com/maps?q=" + encodeURIComponent(club.location.room)
      );
      $('#club-location-data').attr("target", "_blank");
    }

    $('#club-campus').toggle(
      (club.location != null) && (club.location.campus != null)
    );
    if(club.location != null && club.location.campus != null) {
      $('#club-campus-name').text(club.location.campus);
      $('#club-campus-room').text(club.location.room);
    }

    $('#club-sponsor').toggle(club.sponsor != null || club.sponsors != null);
    $('#club-sponsor-name').text(
      (club.sponsors != null ? club.sponsors.join(", ") : club.sponsor)
    );

    $('#club-leader').toggle(club.leader != null);
    $('#club-leader-name').text(club.leader);

    $('#club-members').toggle(club.members != null);
    $('#club-members-qty').text(club.members);

    //$('#club-banner').attr("src", (club.banner_image != null ? club.banner_image : ""));
    var img = bannerImages[id + ""];
    if(img == null && club.banner_image != null) {
      img = new Image();
      img.src = club.banner_image;
      img.classList.add("seamless");
      bannerImages[id + ""] = img;
    }
    if(img != null) $('#club-banner-container').append(img);

    var showSocialIcons = club.social != null;
    $('#club-social-icons').toggle(showSocialIcons);
    if(showSocialIcons) {
      $('#club-social-icons > a').hide();
      for(var key in club.social ) {
        $('#club-social-' + key).show();
        $('#club-social-' + key).attr("href", club.social[key]);
        $('#club-social-' + key).attr("target", "_blank");
      }
    }

    console.log(club);

    $('html,body').scrollTop(0);
  }

  /*
   * Called when user types in search bar
   */
  function searchClubs() {
    var searchbar = $('#search');
    var target = searchbar.val().toLowerCase();
    $('#clubs tr').filter(function() {
      var td = $(this);
      var name = td.find("td:nth-child(1)");
      var type = td.find("td:nth-child(2)");
      //console.log(name);
      td.toggle((name.text().toLowerCase().indexOf(target) > -1)
        || (type.text().toLowerCase().indexOf(target) > -1));
    });
  }

  $(document).ready(function() {
    $.getJSON("https://mariocmflys.tk/stuff/club-directory/clubs.json", function(data) {
      var items = data.clubs;
      clublist = items;
      var clubtable = $("#clubs");
      for(i = 0; i < items.length; i++) {
        var club = items[i];
        if(club.listed != false || club.listed == null) {
          clubtable.append(
            "<tr><td><a href='#"+club.id+"' data-banner='"+ (
              club.banner_image != null ? club.banner_image : ""
            ) +"' data-id='" + club.id + "'>"
            + club.name
            + (club.short_name != null ? " (" + club.short_name + ")" : "")
            + "</a></td><td>"
            + getTypeName(club)
            + "</td></tr>"
          );
        }
      }
      $('#loader').show();
      $('#loader-msg').hide();
      $('#search').prop('disabled', false);

      // Handle hash changing
      setInterval(function() {
        if(window.location.hash != storedHash) {
          storedHash = window.location.hash;
          onHashChanged(storedHash);
        }
      }, 100);

      // Setup preloading
      $("#clubs td a").each(function(i){
        $(this).hover(function(){
          preload(this);
        }, function(){});
      });
    });
  });
  </script>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-sm-0 col-md-1 col-lg-2"></div>
      <div class="col-sm-12 col-md-10 col-lg-8">
        <div class="card main">
          <div id="club-banner-container">
            <!--<img class="seamless" id="club-banner">-->
          </div>
          <div class="card-body body" id="listing-body">
            <div class="page-top">
              <img src="logo.png" alt="Logo">
              <h1>Allen High School</h1>
              <h3>Clubs & Organizations Directory</h3>
              <p id="loader-msg">Loading, please wait</p>
            </div>
            <div id="loader" style="display: none;">
              <div class="search-bar">
                <label class="sr-only" for="search">Search</label>
                <input class="form-control" type="text" name="search" id="search" placeholder="Search" onkeyup="searchClubs()" autocomplete="off" disabled>
              </div>
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Type</th>
                  </tr>
                </thead>
                <tbody id="clubs">
                </tbody>
              </table>
            </div>
          </div>

          <div class="card-body body" id="club-body" style="display: none;">
            <div class="alert alert-secondary" id="club-notice"></div>
            <a href="#list">Clubs & Organizations Directory</a>
            <h4 id="club-name">National Computer Science Honor Society (NCSHS)</h4>
            <p><span id="club-type">Academic - Computer Science</span></p>
            <hr>
            <p id="club-desc"></p>
            <p id="club-website">
              <strong>Website: </strong><a id="club-website-url"></a>
            </p>
            <p id="club-sponsor">
              <strong>Sponsored by: </strong><span id="club-sponsor-name"></span>
            </p>
            <p id="club-leader">
              <strong>Leader: </strong><span id="club-leader-name"></span>
            </p>
            <p id="club-members">
              <strong>Members: </strong><span id="club-members-qty"></span>
            </p>
            <p id="club-meeting">
              <strong>Meets: </strong><span id="club-meeting-time"></span>
            </p>
            <p id="club-location">
              <strong>Location: </strong><a id="club-location-data"></a>
            </p>
            <div id="club-campus">
              <p>
                <strong>Campus: </strong><span id="club-campus-name"></span>
              </p>
              <p>
                <strong>Room: </strong><span id="club-campus-room"></span>
              </p>
            </div>
            <p id="club-social-icons">
              <a id="club-social-twitter"><i class="fab fa-twitter"></i></a>
              <a id="club-social-facebook"><i class="fab fa-facebook"></i></a>
              <a id="club-social-instagram"><i class="fab fa-instagram"></i></a>
              <a id="club-social-github"><i class="fab fa-github"></i></a>
              <a id="club-social-discord"><i class="fab fa-discord"></i></a>
              <a id="club-social-snapchat"><i class="fab fa-snapchat"></i></a>
              <a id="club-social-youtube"><i class="fab fa-youtube"></i></a>
              <a id="club-social-remind"><i class="fas fa-bullhorn"></i></a>
            </p>
          </div>
          <div class="card-body body" id="error-page" style="display: none;">
            <h3>Error: <span id="error-msg"></span></h3>
            <p><a href="#list">Home</a>
              | <a href="#" onclick="history.back()">Back to previous page</a>
          </div>
        </div>
        <div class="center text-muted footer">
          <p>
            AHS Clubs is maintained independently of Allen ISD.<br>
            <a class="text-muted" href="https://forms.gle/335apjRc6f8BazVU6">Suggest Edit</a>
            | <a class="text-muted" href="https://forms.gle/iPyTLsXRp4KpK89u8">New Club</a>
            <br>TECHNICAL PREVIEW
          </p>
        </div>
      </div>
      <div class="col-sm-0 col-md-1 col-lg-2"></div>
  </div>
</body>
</html>
